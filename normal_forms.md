# Нормализация базы данных автосервиса

## Первая нормальная форма (1НФ) - устранение неатомарных данных

### Автомобили и их владельцы
У каждого автомобиля есть ссылка на владельца, но машина может быть семейной и ею могут владеть много людей. Так же при удалении владельца авто, вся информация о нем тоже удалится, но она может быть полезна, если новый владелец обратится с ней в этот автосервис. 

**Проблемы:**
- **Аномалия вставки**: Невозможно добавить нового владельца автомобиля без создания дубликата автомобиля
- **Аномалия удаления**: Не удастся удалить клиента, не удалив все его автомобили

> **Решение:** Мы добавили таблицу `Car_client`, где хранятся связи клиентов и их автомобилей




## Вторая нормальная форма (2НФ) - устранение частичных зависимостей

### Проблема с заказанными услугами
В таблице `client_order_services` есть атрибут `price`, который зависит не от всего составного ключа, а только от части - названия услуги.

**Нарушение:** `service_name → price` (частичная зависимость)

**Проблемы:**
- **Аномалия обновления**: Изменение цены услуги требует поиска и обновления всех заказов
- **Нарушение целостности**: Ручной ввод цены создает риск ошибок и несоответствий
- **Избыточность**: Цены дублируются в множестве записей

> **Решение:**
Удален атрибут `price` из таблицы заказов. Создана отдельная таблица `Service_prices` для централизованного хранения цен (если у услуги поменялась цена, создается новая запись с новой ценой)


### Проблема с заказанными товарами
В таблице `client_order_items` есть атрибут `price`, который зависит не от всего составного ключа, а только от части - артикула товара.

**Нарушение:** `article → price` (частичная зависимость)

**Проблемы:**
- **Аномалия обновления**: Изменение цены товара требует поиска и обновления всех заказов
- **Нарушение целостности**: Ручной ввод цены создает риск ошибок и несоответствий
- **Избыточность**: Цены дублируются в множестве записей

> **Решение:**
Удален атрибут `price` из таблицы заказов. Создана отдельная таблица `Product_prices` для централизованного хранения цен (если у товара поменялась цена, создается новая запись с новой ценой)


### Проблема с остатками товаров
В таблице `remains_of_goods` хранятся цены закупки и продажи, хотя эти атрибуты функционально зависят от артикула товара, а не от всего составного ключа (id точки и артикул товара).

**Нарушение:** `article → price` (частичная зависимость)

**Проблемы:**
- **Аномалия обновления**: Изменение цены товара требует обновления всех записей в остатках на всех точках
- **Нарушение целостности**: Возможность разных цен для одного товара на разных точках
- **Избыточность данных**: Цены дублируются для каждого экземпляра товара на каждой точке

> **Решение:**
Удален атрибуты `purchase_price` и `selling_price` из таблицы `remains_of_goods`. Создана отдельная таблица `Product_prices` для централизованного хранения цен (если у товара поменялась цена, создается новая запись с новой ценой)





## Третья нормальная форма (3НФ) - устранение транзитивных зависимостей

### Проблема с автомобильными марками
Марки и модели автомобилей хранились как простой текст. Модель зависит от марки, что создает транзитивную зависимость

**Проблемы:**
- **Аномалия обновления**: Исправление опечатки в названии марки требует обновления всех связанных записей
- **Несогласованность данных**: Разные написания одной марки ("Toyota", "Тойота") приводят к разделению данных

> **Решение:**
Создана таблица `Car_model` для стандартизации данных.

### Скидка карты клиента
Скидка карты клиента хранится непосредственно в карте, но фактически зависит от количества накопленных баллов, что создает транзитивную зависимость.

**Проблемы:**
- **Аномалия вставки**: Нельзя добавить новые условия программы лояльности без наличия карт с соответствующим количеством баллов
- **Аномалия обновления**: При изменении условий программы лояльности необходимо обновлять все карты, где накоплено соответствующее количество баллов
- **Нарушение целостности**: Ручное изменение уровня скидки без изменения баллов приводит к нарушению бизнес-логики

> **Решение:**
Вынести правила начисления скидок в отдельную таблицу `Loyalty_rules`, где минимальное_количество_баллов является первичным ключом, а в таблице карт хранить только текущее количество баллов.

## Нормальная форма Бойса-Кодда 

Все нарушения 3НФ выше так же являются нарушениями НФБК, так как в обоих случаях проблема в том, что какой-то атрибут определяет другие данные, но сам не является ключом таблицы. НФБК требует, чтобы все детерминанты в таблице были потенциальными ключами.
